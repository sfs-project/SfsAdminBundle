{#
	SfsAdminBundle - Symfony3 project
	(c) Ramine AGOUNE <ramine.agoune@solidlynx.com>
#}

{% block content %}
	{% set formId = 'form-ajax-'~ random() %}

	{{ form_start(form, { 'action': admin_url('create'), 'attr': {'id': formId, 'class': 'form-horizontal form-seperated dashed'} }) }}
		{{ form_errors(form) }}
		
		<!-- Nav tabs -->
		<div class="tabs">
			<div class="tab-title clearfix">
				<h4 class="pull-left">
					New <strong>{{ object }}</strong>
				</h4>
				<ul class="nav nav-tabs pull-right" role="tablist">
					{% for key, tab in form.vars.tabs %}
						<li class="{% if loop.index == 1 %}active{% endif %}" role="presentation">
							<a href="#admin-tab-{{ key }}" role="tab" data-toggle="tab">{{ tab.title }}</a>
						</li>
					{% endfor %}
				</ul>
			</div>

			<!-- Tab panes -->
			<div class="tab-content">
				{% for key, tab in form.vars.tabs %}
					<div id="admin-tab-{{ key }}" class="tab-pane fade row {% if loop.index == 1 %}in active{% endif %}" role="tabpanel">
						{% for block in tab.blocks %}
							{% set blockColumnClass = attribute(form.vars.blocks, block).classes.column | default('col-md-12') %}
							{% set blockPanelClass = attribute(form.vars.blocks, block).classes.panel | default('panel-primary') %}

							<div class="col-sm-12">
								<div class="panel {{ blockPanelClass }}">
									<div class="panel-heading">{{ attribute(form.vars.blocks, block).title }}</div>
									<div class="panel-body">
										<div class="form-body">
											{% for field in attribute(form.vars.blocks, block).fields %}
												{{ form_row(attribute(form.children, field)) }}
											{% endfor %}
										</div>
									</div>
								</div>
							</div>
						{% endfor %}
					</div>
				{% endfor %}
				{{ form_rest(form) }}
			</div>
		</div>

		<button class="btn btn-success" name="btn_save" type="submit">
			<i class="fa fa-save"></i> {% trans %}sfs.admin.action.button.save{% endtrans %}
		</button>
	{{ form_end(form) }}

	{#{{ dump(form.vars) }}#}
<script>
    // this is the id of the form
    $("#{{ formId }}").submit(function(e) {
        e.preventDefault();

        $.ajax({
            type: "{{ form.vars.method }}",
            url: "{{ admin_url('create') }}",
            data: $("#{{ formId }}").serialize(), // serializes the form's elements.
            success: function(data)
            {
				location.reload();
            }
        });
    });
</script>
{% endblock %}
